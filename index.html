<!DOCTYPE html>
<html>
<head>
    <title>CLSI Breakpoint Finder with JSON</title>
    <script>
        let jsonData = []; // Global variable to store loaded JSON data

        // Function to load JSON from an external file
        async function loadJSON() {
            try {
                const response = await fetch('breakpoints.json'); // Ensure this file is accessible
                if (!response.ok) throw new Error('Failed to load JSON data.');
                jsonData = await response.json();
                console.log("JSON data loaded successfully.", jsonData);
            } catch (error) {
                console.error("Error loading JSON:", error);
                document.getElementById("result").innerHTML = "Error loading data. Please try again later.";
            }
        }

        // Function to handle form submission and filter JSON data
        function getBreakpoint() {
            const organismInput = document.getElementById("organism").value.trim().toLowerCase();
            const antimicrobialInput = document.getElementById("antimicrobial").value.trim().toLowerCase();

            // Filter JSON data
            const results = jsonData.filter(entry =>
                (!organismInput || entry.organism.toLowerCase().includes(organismInput)) &&
                (!antimicrobialInput || entry.antimicrobial.toLowerCase().includes(antimicrobialInput))
            );

            // Format results for display
            const formattedResults = results.length > 0
                ? results.map(entry => `
                    <b>Organism:</b> ${entry.organism}<br>
                    <b>Antimicrobial:</b> ${entry.antimicrobial}<br>
                    <b>Breakpoint:</b> ${entry.breakpoint}<br>
                    <b>Urine Breakpoint:</b> ${entry.urine_breakpoint}<br>
                    <b>Notes:</b> ${entry.notes}<br><hr>
                `).join('')
                : "No data found for the given input.";

            // Display results in the result section
            document.getElementById("result").innerHTML = formattedResults;
        }

        // Load JSON data when the page loads
        window.onload = loadJSON;
    </script>
</head>
<body>
    <h1>CLSI Breakpoint Finder with JSON</h1>
    <form onsubmit="event.preventDefault(); getBreakpoint();">
        <label for="organism">Enter Organism:</label>
        <input type="text" id="organism" name="organism" placeholder="e.g. E. coli"><br><br>
        <label for="antimicrobial">Enter Antimicrobial (leave blank for all):</label>
        <input type="text" id="antimicrobial" name="antimicrobial" placeholder="e.g. Cefepime"><br><br>
        <input type="submit" value="Get Breakpoint">
    </form>

    <h3>Result:</h3>
    <p id="result"></p>
</body>
</html>
